### 2021-2-19  时间序列预测3 

一般来说，时间序列建模中会把数据分为两种，一种是动态数据，比如我们的销量这类的要预测的标签，一种是静态数据，比如城市、商店等；

下面还是分情况讨论：

（1）、单独考虑动态数据，需要知道的是，我们常常面临着多元时间序列问题，一般来说，这里的”多元“值得是我们具有多个动态数据，以典型的天气预测为例，温度是动态的，压强是动态的，如果我们对温度进行rolling mean之类的计算，则rolling的结果也是动态的，比如说我们用过去三个小时的温度，预测未来两个小时的问题，则数据是这样的：

训练数据 预测数据

温度：【20,30,25】 [24,31]

压强： [100,200,150] [24,31]

**第一种输入方法：**

【20，100】

【30，200】

【25，150】

这是一个 （1，3，2）的数据，也就是这里其实就一个样本，注意，时间序列中的样本和结构化数据的样本概念不同，我们平常接触的比较多的结构化数据问题中，一个样本是一行，时间序列中，一个样本是time steps行，因为我们使用历史3个小时的数据，所以这里一个样本是3行，我们一般称之为 一个样本中包含了3个时间切片数据，同时每一个时间切片下有两个特征。

预测标签为[24,31]也就是未来的两个时间步，这里没有考虑gap，即提前预测的问题，主要是为了描述方便；

常见的方法就是把多个动态数据源当作多元时间序列，即每个时间切片上有多个特征，n个动态数据源就有n个特征，上面的例子中温度和压强分别是两个动态数据源，因此是一个2元时间序列预测的数据形式，此时我们可以输入一个RNN或者一个CNN的深度模型结构中进行建模；

**第二种输入方法：**

第二种输入方法，就是把每一个动态数据源分开来建模，此时的输入数据形式为：

[20]

[30]

[25]

和

[100]

[200]

[150]

然后每个动态数据源分别用一个深度学习模型来建模，最后将结构concat起来，这里用CNN的多通道模型更好理解一点：

![img](https://pic4.zhimg.com/80/v2-9c7fb8ff9718759e0baa527bb6211d9b_720w.jpg)

cnn中有多通道的概念，RNN中就是直接搞多个RNN模型来分别建模最后concat每一个RNN的输出。

------

下面介绍3种策略：

**第一种：向量输出策略：**

![img](https://pic4.zhimg.com/80/v2-a27bdf52de4f8ba36e61b79824ac285b_720w.jpg)

这种策略的优点是实现简单，训练快，缺点就是没有考虑输出的标签之间的序列依赖性，输出就是一个简单的全连接层，比如我们输出未来三个时间步则直接Dense （units=3）就可以了；

第二种：seq2seq策略（最简单版本的seq2seq）：

![img](https://pic1.zhimg.com/80/v2-b26619d26c363f130306368121d3fdc0_720w.jpg)

![img](https://pic1.zhimg.com/80/v2-8b73bee460952aa2b5f77976247eb48c_720w.jpg)

优点是考虑了输出的标签之间的序列依赖性，缺点是训练起来比较慢；代码如上

第三种策略：复杂的一笔的seq2seq

这部分涉及到seq2seq的不同架构方式，

[马东什么：seq2seq by keras 总结zhuanlan.zhihu.com![图标](https://zhstatic.zhihu.com/assets/zhihu/editor/zhihu-card-default.svg)](https://zhuanlan.zhihu.com/p/124583685)

不过微软的教材里给出的是teacher forcing的方式，也就是下面会介绍的递归的seq2seq，这个也是seq2seq较常采用的训练方式，但是时间序列预测的标签是连续的无法使用beam search。

第三种策略叫递归的seq2seq

![img](https://pic2.zhimg.com/80/v2-d6b98659a2b2ae972d03c4c49e1c7d31_720w.jpg)

![img](https://pic2.zhimg.com/80/v2-bb8d29e10f07dbd04f12eb28674cff99_720w.jpg)

![img](https://pic2.zhimg.com/80/v2-0cc4e5f5215380f483f74d2a25fdb38d_720w.jpg)

好处是考虑了输出的序列依赖性，同时可以支持任意长度时间步的未来预测（kaggle webtraffic top1利用了支持不定长的特点提出了随机训练样本长度的数据增强方法很有意思）莫得代码，我发的git上有demo还没看。

坏处是显然实现起来复杂，而且跑得慢。

